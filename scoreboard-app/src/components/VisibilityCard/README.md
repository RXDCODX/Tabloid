# VisibilityCard - Управление видимостью панели скорборда

## Описание

Компонент `VisibilityCard` позволяет включать и выключать отображение панели скорборда с анимацией затухания. Состояние видимости сохраняется на бекенде и синхронизируется между всеми подключенными клиентами. Также отображает информацию о времени последнего обновления и времени открытия страницы (только JavaScript).

## Функциональность

### Основные возможности:
- **Включение/выключение панели**: Компактная кнопка для переключения видимости панели скорборда
- **Анимация затухания**: Плавная анимация при переключении состояния (500ms)
- **Блокировка повторных нажатий**: Во время анимации кнопка блокируется для предотвращения множественных нажатий
- **Визуальная обратная связь**: Спиннер загрузки и изменение текста кнопки во время анимации
- **Синхронизация**: Состояние автоматически синхронизируется между всеми подключенными клиентами
- **Компактный дизайн**: Оптимизирован для размещения в один ряд с MetaPanel
- **Информация о времени**: Отображение времени последнего обновления и времени открытия страницы (только JavaScript)
- **Реальное время**: Время открытия страницы обновляется каждую секунду

### Состояния кнопки:
- **Видимая панель**: Красная кнопка "Скрыть" с иконкой EyeSlash
- **Скрытая панель**: Зеленая кнопка "Показать" с иконкой Eye
- **Анимация**: Полупрозрачная кнопка с спиннером и текстом "Скрываем..." или "Показываем..."

### Информация о времени (JavaScript):
- **Время последнего обновления**: Отображается в формате ЧЧ:ММ:СС с иконкой Clock
- **Время открытия страницы**: Отображается в формате "Xч Yм Zс" или "Xм Yс" или "Zs" с иконкой PlayCircle
- **Обновление в реальном времени**: Время открытия страницы обновляется каждую секунду
- **Локальное время**: Время последнего обновления обновляется при изменении видимости
- **Центрированное отображение**: Вся информация о времени размещена по центру карда

## Использование

```tsx
import VisibilityCard from './VisibilityCard';

const AdminPanel = () => {
  const { isVisible, setVisibility } = useAdminState();
  
  return (
    <Row className="mb-4">
      <Col xs={12} md={6} lg={6}>
        <VisibilityCard 
          isVisible={isVisible} 
          onVisibilityChange={setVisibility}
        />
      </Col>
      <Col xs={12} md={6} lg={6}>
        <MetaPanel setMeta={setMeta} meta={meta} />
      </Col>
    </Row>
  );
};
```

## Стилизация

Компонент использует:
- **Цветовая схема**: Красный (#dc3545) для скрытия, зеленый (#198754) для показа
- **Иконки**: Eye, EyeSlash, Clock, PlayCircle из react-bootstrap-icons (размер 20px/14px)
- **Анимации**: CSS transitions для плавных переходов
- **Адаптивность**: Responsive дизайн с Bootstrap классами
- **Компактность**: Уменьшенные размеры для размещения в один ряд
- **Выравнивание**: Высота 100% для выравнивания с соседними кардами
- **Центрирование**: Вся информация о времени размещена по центру карда

### Размеры:
- **Иконки**: 20px (уменьшены с 22px)
- **Заголовок**: 14px (уменьшен с 18px)
- **Кнопка**: 120px минимальная ширина (уменьшена с 200px)
- **Текст кнопки**: 12px (уменьшен с 18px)
- **Информация о времени**: 13px (увеличена с 11px)
- **Иконки времени**: 14px (увеличены с 12px)
- **Статус панели**: 12px с жирным шрифтом

### Цвета времени:
- **Текст времени**: Белый (#ffffff) с жирным шрифтом
- **Иконки времени**: Красный (#dc3545) для контраста
- **Статус панели**: Зеленый (#28a745) для видимой, красный (#dc3545) для скрытой

## Интеграция с бекендом

### SignalR методы:
- `UpdateVisibility(bool isVisible)` - обновление состояния видимости
- `ReceiveState` - получение обновленного состояния от сервера

### Сохранение состояния:
- Состояние сохраняется в `config.ini` в секции `[Scoreboard]`
- Ключ: `IsVisible` (true/false)
- Автоматическая загрузка при старте приложения

### Время (только JavaScript):
- **Время последнего обновления**: Обновляется при изменении видимости
- **Время открытия страницы**: Отсчитывается с момента загрузки компонента
- **Локальное время**: Не синхронизируется между клиентами

## Безопасность

- **Необратимость**: Во время анимации затухания процесс нельзя отменить
- **Синхронизация**: Все клиенты получают обновление одновременно
- **Валидация**: Проверка состояния перед отправкой на сервер
- **Таймеры**: Автоматическая очистка интервалов при размонтировании компонента

## Зависимости

- React Bootstrap
- react-bootstrap-icons
- SignalR для синхронизации
- SCSS для стилизации

## Адаптивность

- **xs (мобильные)**: Полная ширина (12 колонок)
- **md (планшеты)**: 6 колонок из 12
- **lg (десктоп)**: 6 колонок из 12
- **Высота**: Автоматически выравнивается с MetaPanel

## Форматирование времени (JavaScript)

### Время последнего обновления:
```typescript
const formatTime = (timestamp: number) => {
  const date = new Date(timestamp);
  return date.toLocaleTimeString('ru-RU', {
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
};
```

### Время открытия страницы:
```typescript
const formatPageOpenTime = () => {
  const diff = currentTime - pageOpenTime;
  const seconds = Math.floor(diff / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  
  if (hours > 0) {
    return `${hours}ч ${minutes % 60}м ${seconds % 60}с`;
  } else if (minutes > 0) {
    return `${minutes}м ${seconds % 60}с`;
  } else {
    return `${seconds}с`;
  }
};
```

### Хуки для обновления времени:
```typescript
// Состояние для времени
const [pageOpenTime, setPageOpenTime] = useState<number>(Date.now());
const [lastUpdateTime, setLastUpdateTime] = useState<number>(Date.now());
const [currentTime, setCurrentTime] = useState<number>(Date.now());

// Обновление текущего времени каждую секунду
useEffect(() => {
  const interval = setInterval(() => {
    setCurrentTime(Date.now());
  }, 1000);

  return () => clearInterval(interval);
}, []);

// Обновление времени последнего обновления при изменении видимости
useEffect(() => {
  setLastUpdateTime(Date.now());
}, [isVisible]);
```

## Преимущества JavaScript-реализации

- **Простота**: Не требует изменений в бекенде
- **Производительность**: Меньше сетевого трафика
- **Локальность**: Время открытия страницы уникально для каждого клиента
- **Гибкость**: Легко настраивать и модифицировать
- **Независимость**: Работает даже без подключения к бекенду
- **Реальное время**: Обновление каждую секунду без задержек

## Компоновка

### Структура карда:
1. **Заголовок**: Иконка и текст "Видимость" (верх)
2. **Кнопка управления**: Кнопка включения/выключения (центр)
3. **Информация о времени**: Время обновления и открытия (центр)
4. **Статус панели**: Текущий статус видимости (центр)

### Выравнивание:
- **Вертикальное**: `justify-content-center` для центрирования всего содержимого
- **Горизонтальное**: `align-items-center` для центрирования элементов времени
- **Отступы**: Увеличенные отступы между секциями для лучшей читаемости

## Технические детали

### Состояния компонента:
- `isTransitioning`: Блокировка повторных нажатий во время анимации
- `pageOpenTime`: Время загрузки компонента (неизменное)
- `lastUpdateTime`: Время последнего изменения видимости
- `currentTime`: Текущее время (обновляется каждую секунду)

### Интервалы и очистка:
- **Интервал обновления**: 1000ms (1 секунда)
- **Автоматическая очистка**: `clearInterval` при размонтировании компонента
- **Оптимизация**: Использование `useEffect` с пустым массивом зависимостей 